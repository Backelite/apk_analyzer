#!/usr/bin/env ruby

$LOAD_PATH.push File.expand_path('../../lib', __FILE__)
require 'apk_analyzer'
require 'optparse'
require 'json'

options = {
  apk_path: nil,
  manifest: false,
  cert_info: true
}

parser = OptionParser.new do |opts|
  opts.on('-f', '--file FILE PATH', 'Apk file path') do |file_path|
    options[:apk_path] = file_path
  end

  opts.on('-m', '--manifest', 'Collects Manifest.xml informations') do
    options[:manifest] = true
  end

  opts.on('-c', '--cert-info', 'Collects Certificate issuer and related dates') do
    options[:cert_info] = true
  end
end

parser.parse!
raise 'File not specified' if options[:apk_path].nil?
apk_analyzer = ApkAnalyzer::Analyzer.new(File.expand_path(options[:apk_path]))
apk_data = {}
apk_data[:manifest_info] = apk_analyzer.collect_manifest_info if options[:manifest]
apk_data[:cert_info] =  apk_analyzer.collect_cert_info if options[:cert_info]
puts JSON.pretty_generate(apk_data)
